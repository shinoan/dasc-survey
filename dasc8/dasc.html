<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>アンケート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <h2>アンケート</h2>

  <form id="form">
    <p>ID（必須）:<br>
      <input type="text" name="id" required>
    </p>

    <p>氏名（必須）:<br>
      <input type="text" name="name" required>
    </p>

    <p>生年月日（必須）:<br>
      <input type="date" name="birth" required>
    </p>

    <p>性別（必須）:<br>
      <label><input type="radio" name="gender" value="男性"> 男性</label><br>
      <label><input type="radio" name="gender" value="女性"> 女性</label>
    </p>

    <p>独居 or 同居（必須）:<br>
      <label><input type="radio" name="living" value="独居"> 独居</label><br>
      <label><input type="radio" name="living" value="同居"> 同居</label>
    </p>

    <p>握力（必須）:<br>
      <p>右</p>
      <input type="text" name="gripr" required><br>
      <p>左</p>
      <input type="text" name="gripl" required><br>
    </p>

    <hr>

    <p>A: もの忘れが多いと感じますか</p>
    <label><input type="radio" name="a" value="1"> 感じない</label><br>
    <label><input type="radio" name="a" value="2"> 少し感じる</label><br>
    <label><input type="radio" name="a" value="3"> 感じる</label><br>
    <label><input type="radio" name="a" value="4"> とても感じる</label><br>

    <p>B: １年前と比べて、もの忘れが増えたと感じる</p>
    <label><input type="radio" name="b" value="1"> 感じない</label><br>
    <label><input type="radio" name="b" value="2"> 少し感じる</label><br>
    <label><input type="radio" name="b" value="3"> 感じる</label><br>
    <label><input type="radio" name="b" value="4"> とても感じる</label><br>


    <p>Q1: 財布や鍵など、物を置いた場所が分からなくなることがありますか</p>
    <label><input type="radio" name="q1" value="1"> まったくない</label><br>
    <label><input type="radio" name="q1" value="2"> ときどきある</label><br>
    <label><input type="radio" name="q1" value="3"> 頻繁にある</label><br>
    <label><input type="radio" name="q1" value="4"> いつもそうだ</label><br>

    <p>Q2: 今日が何月何日かわからないときがありますか</p>
    <label><input type="radio" name="q2" value="1"> まったくない</label><br>
    <label><input type="radio" name="q2" value="2"> ときどきある</label><br>
    <label><input type="radio" name="q2" value="3"> 頻繁にある</label><br>
    <label><input type="radio" name="q2" value="4"> いつもそうだ</label><br>

    <p>Q3: 一人で買い物はできますか</p>
    <label><input type="radio" name="q3" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q3" value="2"> だいたいできる</label><br>
    <label><input type="radio" name="q3" value="3"> あまりできない</label><br>
    <label><input type="radio" name="q3" value="4"> まったくできない</label><br>

    <p>Q4: バスや電車、自家用車などを使って一人で外出できますか</p>
    <label><input type="radio" name="q4" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q4" value="2"> だいたいできる</label><br>
    <label><input type="radio" name="q4" value="3"> あまりできない</label><br>
    <label><input type="radio" name="q4" value="4"> まったくできない</label><br>

    <p>Q5: 貯金の出し入れや、家賃や公共料金の支払いは一人でできますか</p>
    <label><input type="radio" name="q5" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q5" value="2"> だいたいできる</label><br>
    <label><input type="radio" name="q5" value="3"> あまりできない</label><br>
    <label><input type="radio" name="q5" value="4"> まったくできない</label><br>

    <p>Q6: トイレは一人でできますか</p>
    <label><input type="radio" name="q6" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q6" value="2"> 見守りや声がけを要する</label><br>
    <label><input type="radio" name="q6" value="3"> 一部介助を要する</label><br>
    <label><input type="radio" name="q6" value="4"> 全介助を要する</label><br>

    <p>Q7: 食事は一人でできますか</p>
    <label><input type="radio" name="q7" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q7" value="2"> 見守りや声がけを要する</label><br>
    <label><input type="radio" name="q7" value="3"> 一部介助を要する</label><br>
    <label><input type="radio" name="q7" value="4"> 全介助を要する</label><br>

    <p>Q8: 家の中での移動は一人でできますか</p>
    <label><input type="radio" name="q8" value="1"> 問題なくできる</label><br>
    <label><input type="radio" name="q8" value="2"> 見守りや声がけを要する</label><br>
    <label><input type="radio" name="q8" value="3"> 一部介助を要する</label><br>
    <label><input type="radio" name="q8" value="4"> 全介助を要する</label><br>

    <button type="button" onclick="handleSubmit()">送信</button>
  </form>

  <h3 id="result">合計点数: -</h3>

  <script>
    function isValidDateFormat(str) {
      return /^\d{4}\/\d{2}\/\d{2}$/.test(str);
    }

    function handleSubmit() {
      const form = document.getElementById("form");
      const fd = new FormData(form);

      const required = ["id", "name", "birth", "gender", "living", "gripr", "gripl", "a", "b", "q1", "q2", "q3", "q4", "q5", "q6", "q7", "q8"];
      for (const f of required) {
        if (!fd.get(f)) {
          alert("すべての項目に入力・選択してください。");
          return;
        }
      }

      // if (!isValidDateFormat(fd.get("birth"))) {
      //   alert("生年月日は「YYYY/MM/DD」の形式で入力してください。");
      //   return;
      // }

      const score = Number(fd.get("q1")) + Number(fd.get("q2")) + Number(fd.get("q3")) + Number(fd.get("q4")) + Number(fd.get("q5")) + Number(fd.get("q6")) + Number(fd.get("q7")) + Number(fd.get("q8"));
      document.getElementById("result").innerText = "合計点数: " + score;

      const data = {
        id: fd.get("id"),
        name: fd.get("name"),
        birth: fd.get("birth"),
        gender: fd.get("gender"),
        living: fd.get("living"),
        gripr: fd.get("gripr"),
        gripl: fd.get("gripl"),
        a: fd.get("a"),
        b: fd.get("b"),
        q1: fd.get("q1"),
        q2: fd.get("q2"),
        q3: fd.get("q3"),
        q4: fd.get("q4"),
        q5: fd.get("q5"),
        q6: fd.get("q6"),
        q7: fd.get("q7"),
        q8: fd.get("q8"),
        score: score
      };

      fetch("https://script.google.com/macros/s/AKfycbyNOwrzln_Lmv67P1otNFyk8yqAoD45lgbP1pX6hbdaUxa_piGGGha5HrFSrjZ1KTns9w/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      }).then(() => {
        alert("送信が完了しました！");
        form.reset();
        document.getElementById("result").innerText = "合計点数: -";
      }).catch(() => {
        alert("送信に失敗しました");
      });
    }
  </script>
</body>
</html>